<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <title>Poptin</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.css" />

  <link rel="stylesheet" href="./style.css" />
  <link href="https://cdn.jsdelivr.net/npm/froala-editor@3.1.0/css/froala_editor.pkgd.min.css" rel="stylesheet" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/froala-editor@3.1.0/js/froala_editor.pkgd.min.js"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="modal fade" id="finalModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true" style="z-index: 9999;" data-backdrop="static">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Final Output</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="clearModal()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div id="final"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-7 d-flex align-items-center justify-content-center">
        <div id="final-form">
          <form action="" method="post" id="popup-container">
            <div id="popup-container">
              <div id="popup-wrapper">
                <div id="dragable-container">
                  <div class="bg-wrapper" style="background-color: rgb(91, 232, 136);">
                    <div class="bg-ring"></div>
                    <img
                      src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJAAAAAuCAMAAADwWGCPAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAW5QTFRFAAAAy1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1y1U1PGywkQAAAHp0Uk5TAAwQTm58gBQ2WngGdjV3JT9rByNHEwENIDBEV2Z5algzEQUVHilRY3N/ZUEtGy9KMkMPIR8LElwdLA4ZNxZ6Lm99KnUDGn4mPXIJe3RWZFRAUmJCAjhxTSRtcBdsCGAcT2FVMWcoRj46W19ZXVNeRQQnSzs5TBgrIjzMOntzAAADEElEQVR4nMWY+0PSUBTHL4IHREPQElEUUBARRDNFslDRRBRNBKwgk1JEyexlz/++PYDtwr3srmj7/rS77865n53tPjaEuiRDT7cydUlGk94ELeoFs94ImCwAfXozYLICQL/eEDJxBQKw6E0hE18gGNCbQpJQIIB7enM0ZRWBbHpzNDQIddn1JqnL0QCCIb1RBA03eeC+3iy8+qUCATzQk2TEOeoaG3dPgFyTnjHvsG9KY5Rpf8A+E5wNAU22uZlwZHR+RCugKJUE04JmQGiRiUczHE4BZZ6HWvIgFFHi6co6suRkv/ZRZ55l1jwrsQ6mY5UdCMXpgwzgMXOahVm6twagZgJ50kvlWWTPMgH0Ej1V+SYm1ik8G+w5vJ2W5E2ApKo5NmYl8mypSLENsP6M4gkDR91g3SG8R6ldFQm8fESaYu4J6VSVaJ8ERLthkrb5iAw5oj6zqCrRLumJDbLHe8UIYolWDuo3qOaDj7iE0J5Au5w2MSLjw1H8kfDhc2kMB4+yruU1poxpEtA4Q6DBv2E/ziUbISG3Jx9ddhY458S0lyJlhRcmhsH7khTpUIp6VSwR+wwdmNLo9QARh9OpTykxQkFSYPKNUnlytD4hztlnZMujjIMKNmJoWTHwLbnPSfFrfJXoMfAgc/Pyd/HYebNxoRxJrIK7Mfw97V6FaTJp7IoqAb51Wak3qwyhhCrkpA3mUasXZNt8XgkX264b7eipcKLGEttWhfdy9wazQh+YcBA65i7OhOVfh15uPYQSU/AtzvMRM/dTcs/KyMNN/MVPhpZz2SJA6zmyihgQPh/vYF6KbVZEiQxxUnZtM21fP+NbhS+YacHLF2ADWqJUYopp9SnjfV5jZh43r9iA/k0XeJ95zPyKm7daAFXxPo2YeSievMuK+5uKFkA1sc/qN3FA5TBzkj91Po2Q7zt/lNHiZ0FJeBYJhHqM/JGtIPOGuMLU4uKxmZ8ffvx/HgPXzc28eJzgZ2b5n5yfcPZLal3OafFWR8ERkVrlPriTmVstv5hPVHxX/a22fuNtr7gk/wEI2mDYM0Y/wwAAAABJRU5ErkJggg=="
                      alt="" style="position: absolute; left: 180px; top: 50px;">
                    <div id="editor">
                      <div id="editor-elements"
                        class="draggable enable-editor ui-draggable ui-draggable-handle fr-box fr-inline"
                        role="application" style="position: relative; left: 90px; top: 116px;">
                        <div class="fr-wrapper">
                          <div class="fr-element fr-view" contenteditable="true" aria-disabled="false"
                            spellcheck="true">
                            <p style="text-align: center;">
                              <strong>
                                <span style="font-size: 30px; color: rgb(255, 255, 255);">
                                  <em>Don't leave without an&nbsp;</em>
                                </span>
                              </strong>
                            </p>
                            <p style="text-align: center;">
                              <strong>
                                <span style="font-size: 30px; color: rgb(255, 255, 255);">
                                  <em>exclusive offer from us!</em>
                                </span>
                              </strong>
                            </p>
                          </div>
                        </div>
                      </div>
                      <div id="editor-inputs" class="draggable ui-draggable ui-draggable-handle"
                        style="position: relative; left: 75px; top: 135px;">
                        <input id="input-4o9ddxmfp" placeholder="Email Address" value="" class="form-input">
                      </div>
                      <button class="draggable btn btn-submit ui-draggable ui-draggable-handle"
                        style="position: relative; left: 74px; top: 132px;">
                        I want to hear!
                      </button>
                      <div class="draggable enable-editor ui-draggable ui-draggable-handle fr-box fr-inline"
                        role="application" style="position: relative; left: 87px; top: 152px;">
                        <div class="fr-wrapper" dir="auto">
                          <div class="fr-element fr-view" dir="auto" contenteditable="true" aria-disabled="false"
                            spellcheck="true">
                            <p>
                              <span style="color: rgb(255, 255, 255);">Don't leave without an exclusive offer from us!</span>
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="col-md-5">
        <button class="btn btn-success mb-2 mt-2" onclick="savePopup()">Save</button>
        <button class="btn btn-warning mb-2 mt-2" onclick="resetPopup()">Reset</button>
        <div class="accordion" id="accordion">
          <div class="card">
            <div class="card-header" id="general-settings">
              <h2 class="mb-0">
                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne"
                  aria-expanded="true" aria-controls="collapseOne">General Settings</button>
              </h2>
            </div>
            <div id="collapseOne" class="collapse show" aria-labelledby="general-settings" data-parent="#accordion">
              <div class="card-body">
                <h6>Background Color</h6>
                <input type="text" id="picker" />
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="input-fields">
              <h2 class="mb-0">
                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo"
                  aria-expanded="false" aria-controls="collapseTwo">Input Fields</button>
              </h2>
            </div>
            <div id="collapseTwo" class="collapse" aria-labelledby="input-fields" data-parent="#accordion">
              <div class="card-body">
                <button class="btn btn-primary mb-3" onclick="addField()">Add Field</button>
                <div id="fields">
                  <div id="field-4o9ddxmfp" class="d-flex justify-content-between align-items-end">
                    <div class="form-group">
                      <label for="type">Type</label>
                      <select id="4o9ddxmfp" onchange="changeType(this)" class="form-control">
                        <option value="text" selected>Text</option>
                        <option value="email">Email</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="placeholder">Placeholder</label>
                      <input name="field" type="text" placeholder="" id="4o9ddxmfp" class="form-control"
                        value="Email Address" />
                    </div>
                    <div class="form-group">
                      <button onclick="removeField('4o9ddxmfp')" class="btn btn-danger">Remove</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function clearModal() {
      $("#final").html("");
    }
    (function ($) {
      $('a[href="https://www.froala.com/wysiwyg-editor?k=u"]').remove();
    })(jQuery);

    function resetPopup() {
      $.ajax({
        type: "GET",
        headers: {
          "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
        },
        url: "http://3.6.120.180/api/poptin/552b34",
        success: function (response) {
          $('#final-form').html(response.poptin.form_html);
          $(".draggable").draggable({
            containment: "parent"
          });
        }
      })
    }

    function savePopup() {
      let popup = $("#final-form").html();
      let popup_data = {
        form_id: '552b34',
        form_name: "Test",
        form_html: popup
      };

      $.ajax({
        type: "POST",
        headers: {
          "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content")
        },
        url: "http://3.6.120.180/api/poptin/update",
        data: popup_data,
        success: function (response) {
          $("#final").text('<script type="text/javascript" src="' + response.poptin_url +
            '"></scr' + 'ipt>');
          $("#finalModal").modal("show");
        }
      });
    }

    function addField() {
      let random = Math.random().toString(36).substr(2, 9);
      let result =
        `<div id="field-${random}" class="d-flex justify-content-between align-items-end"><div class="form-group"><label for="type">Type</label><select id="${random}" onchange="changeType(this)" class="form-control"><option value="text">Text</option><option value="email">Email</option></select></div><div class="form-group"><label for="placeholder">Placeholder</label><input name="field" type="text" placeholder="" id="${random}" class="form-control" value=""/></div><div class="form-group"><button onclick="removeField('${random}')" class="btn btn-danger">Remove</button></div></div>`;
      let editorResult =
        `<input id="input-${random}" placeholder="" value="" class="draggable ui-draggable ui-draggable-handle form-input"/>`;
      $("#fields").append(result);
      $("#editor-inputs").append(editorResult);
    }

    $(document).on("input", function (e) {
      $(`#input-${e.target.id}`).attr("placeholder", e.target.value);
    });

    function changeType(e) {
      $(`#input-${e.id}`).attr("type", e.value);
    }

    function removeField(element) {
      $(`#field-${element}`).remove();
      $(`#input-${element}`).remove();
    }

    function addElement(type) {
      let random = Math.random().toString(36).substr(2, 9);
      let editorResult, result;
      if (type === "text") {
        editorResult = `<p class="draggable element-text" id="element-${random}">Enter Your Text</p>`;
        result = `<input id="${random}" class="form-control" type="text" value="Enter Your Text"/>`;
      } else if (type === "button") {
        editorResult = "";
      } else {
        editorResult = "";
      }
      $("#editor").append(editorResult);
      $(".draggable").draggable({
        containment: "parent"
      });
      $('a[href="https://www.froala.com/wysiwyg-editor?k=u"]').remove();
    }
    $(function () {
      var editor = new FroalaEditor('.enable-editor', {
        toolbarInline: true,
        toolbarVisibleWithoutSelection: true,
        fontFamilySelection: true,
        fontFamily: {
          "Roboto,sans-serif": "Roboto",
          "Oswald,sans-serif": "Oswald",
          "Montserrat,sans-serif": "Montserrat",
          "'Open Sans Condensed',sans-serif": "Open Sans Condensed"
        },
        toolbarButtons: [
          "bold",
          "italic",
          "textColor",
          "backgroundColor",
          "align",
          "fontFamily",
          "fontSize"
        ]
      });

      $('a[href="https://www.froala.com/wysiwyg-editor?k=u"]').remove()

      $(".draggable").draggable({
        cancel: false,
        containment: "parent"
      });

      const defaultColor = $(".bg-wrapper").css("background-color");

      $("#picker").spectrum({
        color: defaultColor ? defaultColor : "green",
        flat: true,
        showInput: true,
        showAlpha: true,
        showInitial: true,
        showSelectionPalette: false,
        maxSelectionSize: 10,
        preferredFormat: "rgba",
        localStorageKey: "spectrum",
        move: function (color) {
          $(".bg-wrapper").css(
            "background-color",
            `rgba(${color._r},${color._g},${color._b},${color._a})`
          );
        },
      });
    });
    $(window).on("load", function () {
      $('a[href="https://www.froala.com/wysiwyg-editor?k=u"]').parent().remove();
    });
  </script>
</body>

</html>